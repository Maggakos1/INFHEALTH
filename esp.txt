local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local localPlayer = Players.LocalPlayer
local camera = workspace.CurrentCamera

-- Table to store ESP objects
local espBoxes = {}

-- Function to create Billboard GUI over a character
local function createESP(player)
	if player == localPlayer then return end
	if espBoxes[player] then return end

	local espGui = Instance.new("BillboardGui")
	espGui.Name = "ESP"
	espGui.Size = UDim2.new(0, 100, 0, 40)
	espGui.StudsOffset = Vector3.new(0, 3, 0)
	espGui.AlwaysOnTop = true

	local nameLabel = Instance.new("TextLabel")
	nameLabel.Size = UDim2.new(1, 0, 1, 0)
	nameLabel.BackgroundTransparency = 1
	nameLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
	nameLabel.TextStrokeTransparency = 0.5
	nameLabel.Text = player.Name
	nameLabel.TextScaled = true
	nameLabel.Parent = espGui

	local function onCharacterAdded(character)
		repeat wait() until character:FindFirstChild("HumanoidRootPart")
		espGui.Adornee = character:WaitForChild("HumanoidRootPart")
		espGui.Parent = character
	end

	if player.Character then
		onCharacterAdded(player.Character)
	end

	player.CharacterAdded:Connect(onCharacterAdded)
	espBoxes[player] = espGui
end

-- Monitor players joining
for _, player in ipairs(Players:GetPlayers()) do
	createESP(player)
end

Players.PlayerAdded:Connect(createESP)

-- Clean up ESP when players leave
Players.PlayerRemoving:Connect(function(player)
	if espBoxes[player] then
		espBoxes[player]:Destroy()
		espBoxes[player] = nil
	end
end)
